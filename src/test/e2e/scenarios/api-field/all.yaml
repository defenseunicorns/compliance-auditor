---
apiVersion: v1
kind: Namespace
metadata:
  name: validation-test
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-conf
  namespace: validation-test
data:
  nginx.conf: |
    user  nginx;
    worker_processes  auto;
    error_log  /var/log/nginx/error.log notice;
    pid        /var/run/nginx.pid;
    events {
      worker_connections  1024;
    }
    http {
      server {
        listen       80;
        server_name  _;
        location / {
          add_header Content-Type application/json;
          return 200 '{"pass":true}\n';
        }
      }
    }
---
apiVersion: v1
kind: Pod
metadata:
  name: test-api-field
  namespace: validation-test
  labels:
    app: api-field
spec:
  containers:
  - image: nginx
    name: nginx
    ports:
    -  containerPort: 80
    volumeMounts:
    - mountPath: /etc/nginx
      readOnly: true
      name: nginx-conf
  volumes:
  - name: nginx-conf
    configMap:
      name: nginx-conf
      items:
      - key: nginx.conf
        path: nginx.conf
---
apiVersion: v1
kind: Service
metadata:
  name: api-field
  namespace: validation-test
  labels:
    app: api-field
spec:
  type: ClusterIP
  ports:
  - name: http
    port: 80
    protocol: TCP
    targetPort: 80
  selector:
    app: api-field
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: api-field-ingress
  namespace: validation-test
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /$2
spec:
  rules:
  - http:
      paths:
      - pathType: Prefix
        path: /api-field
        backend:
          service:
            name: api-field
            port:
              number: 80